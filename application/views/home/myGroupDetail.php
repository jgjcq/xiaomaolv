<?phpdefined('BASEPATH') OR exit('No direct script access allowed');?><!DOCTYPE html><html><head>    <?php    include_once 'public/views/home/header.php';    ?>    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><style type="text/css">    .btn-left a{        width: 5rem;        border-radius: 1rem;        background-color: #f5d809 !important;        font-size: 0.5rem;        height: 1.5rem;        line-height: 1.5rem !important;        color: #000 !important;        width: 6rem;    }    .btn-right a{        width: 5rem;        border-radius: 1rem;        background-color: #ea7a1a !important;        font-size: 0.5rem;        height: 1.5rem;        line-height: 1.5rem !important;        color: #fff !important;        width: 6rem;    }</style></head><body><div class="page-group">    <div class="page page-current">        <!-- 标题栏 -->        <header class="bar bar-nav">            <a class="icon pull-right"></a>            <h1 class="title">拼团详情页</h1>        </header>        <!-- 工具栏 -->        <nav class="bar bar-tab">            <a class="tab-item external " href="Home">                <span class="icon dh_sy" ></span>                <span class="tab-label">首页</span>            </a>            <a class="tab-item external " href="Home/myCourse">                <span class="icon dh_wdkc"></span>                <span class="tab-label">我的课程</span>            </a>            <a class="tab-item external active" href="Home/my">                <span class="icon dh_grzx1"></span>                <span class="tab-label">个人中心</span>            </a>        </nav>        <!-- 这里是页面内容区 -->        <div class="content" style="background: #ffffff;top:0">            <div class="content-block" style="padding:0 15px;margin: 0.75rem 0">                <div class="col-100 kc_list">                    <?php                    if(isset($zs_video_big)){                    ?>                    <video id='my_video' class='video-js' controls preload='auto' style="width: 100%;height: 10rem;"                           poster='<?=$zs_video_big['thumb']?>' data-setup='{}'  x-webkit-airplay="true" x5-playsinline="true" webkit-playsinline="true" playsinline="true">                        <source src='<?=$zs_video_big['url']?>' type='video/mp4'>                    </video>                </div>                <?php                }else{                    $srcImg = $course['article_image'];                    if($course['article_image_big']){                        $srcImg = $course['article_image_big'];                    }                    ?>                    <img width="100%" height="197px" src="<?=$srcImg?>"  />                    <?php                }                ?>                </div>                <div class="col-100 kc-title" style="font-size: 1rem;">                   <?=$course['title']?>                </div>                <div class="col-100 kc-price">                    <div class="row  ">                        <div class="col-50" style="font-size: 0.7rem;line-height: 2rem;">                            <?php                                if($order['status'] == 4){                                    echo '团购已完成';                                }elseif($order['status'] == 3){                                    echo '<span style="color:red">拼团失败</span>';                                }else{                                    echo "您已参团仅需".(3-$order['total'])."人成团";                                }                            ?>                        </div>                        <div class="col-50">                            <div class="avatar-list avatar-list-stacked">                                <?php                                $i = 0;                                foreach($buyList as $buy){                                    if($i >4) break;                                    $i++;                                    ?>                                    <span class="avatar cover-image brround" data-image-src="<?=$buy['head_img']?>" style="background-image: url('<?=$buy['head_img']?>') ">                                            </span>                                    <?php                                }                                ?>                            </div>                        </div>                    </div>                    <div class="kc-after" style="padding-top:0.5rem "></div>                </div>                <div class="col-100" style="font-size: 14px;margin: 7px 0">                    <img src="cust/images/ptsysj.png" style="width: 1.2rem"><span style=" display: inline-block ;transform:translate(0,2px);padding-left: 0.2rem">                        <?php                            if($order['status'] == 3){                                echo '拼团失败';                            }elseif($order['status'] == 4){                                echo '拼团成功';                        }else{                                ?>                                 剩余拼团时间:</span><span id="ptTime" style="display: inline-block ;transform:translate(0,2px);margin-left: 3px" data-pttime="<?=$order['end_time']?>">                        <?php                            }                        ?>                    </span>                </div>                <div class="kc-after" style="padding-top:0.5rem;margin-left: -4%;margin-right: -4%;border-bottom: 1rem solid #f1f1f1; "></div>                <div class="col-100" style="padding-top: 1.3rem;overflow: hidden;padding-left: .5rem;padding-right: .5rem">                    <?php                    if($order['status'] == 3){                        ?>                        <a style="width: 50%;border-radius: 30px;background:#fab510;margin: 0 auto;height:40px;line-height: 40px !important;" class="button button-fill" href="#" onclick="reBuy(<?=$order['id']?>)">重新拼团</a>                    <?php                    }elseif($order['status'] == 4){                        ?>                        <a style="   border-radius:30px; background: #FFBA00;color: #000;margin: 0 auto;    width: 50%;height:40px;line-height: 40px !important; " class="button button-fill  external" href="Home/myCourse/detail/<?=$order['course_id']?>" >开始学习</a>                        <?php                    }else{                    ?>                        <span style="float: left" class="btn-left"><a style="font-size:16px;line-height:1.8rem !important;height: 1.8rem" class="button button-fill" href="#" id="fx">分享海报</a></span>                        <span style="float: right" class="btn-right"><a style="font-size:16px;line-height:1.8rem !important;height: 1.8rem" class="button button-fill">邀请好友参团</a></span>                        <?php                        }                        ?>                </div>            <div class="col-100">                <div id="qrcode" style="margin-top: 2rem;text-align: center">                    <img width="50%" src="cust/images/组 7.png" alt="">                    <p style="font-size: 14px">扫码加入 "小毛驴" 学堂，掌握实时拼团进度</p>                </div>            </div>            </div>        </div>    </div></div>    <?php    include_once 'public/views/home/script.php';    ?><script type="text/javascript" src="public/assets/js/jquery-2.0.3.min.js"></script><script type="text/javascript" src="public/assets/js/jquery.qrcode.min.js"></script><script type="text/javascript">       wx.config({           debug: true,           appId: "<?=$signPackage['appId']?>",           timestamp: <?=$signPackage['timestamp']?>,           nonceStr: "<?=$signPackage['nonceStr']?>",           signature: "<?=$signPackage['signature']?>",           jsApiList: ['onMenuShareAppMessage',               'onMenuShareTimeline',               'chooseWXPay',               'showOptionMenu',               "updateAppMessageShareData",               "hideMenuItems",               "showMenuItems",               "onMenuShareTimeline",               'onMenuShareAppMessage']       });       wx.ready(function() {           wx.checkJsApi({               jsApiList: [                   'updateAppMessageShareData'               ],               success: function(res) {                    console.log(res)               }           });           $('#fx').click(function () {               //分享到朋友圈               wx.updateAppMessageShareData({                   title: "<?=$course['title']?>",                   desc: "分享课程",                   link: 'http://fineui.dye360.cn/Home/course/fx/<?=$id?>/<?=$_SESSION['app_home_session']['id']?>',                   imgUrl:"<?=$course['article_image']?>" ,                   success: function() {                       getFxPrice()                       alert("分享成功！")                       // 用户确认分享后执行的回调函数                   },                   cancel: function() {                       alert("取消分享！")                       // 用户取消分享后执行的回调函数                   }               });           })           //分享给朋友           wx.onMenuShareAppMessage({               title: "<?=$course['title']?>",               desc: "分享课程",               link: 'http://fineui.dye360.cn/Home/course/fx/<?=$id?>/<?=$_SESSION['app_home_session']['id']?>',               imgUrl:"<?=$course['article_image']?>" ,               success: function() {                   getFxPrice()                   alert("分享成功！")                   // 用户确认分享后执行的回调函数               },               cancel: function() {                   alert("取消分享！")                   // 用户取消分享后执行的回调函数               }           });       });function weixinSendAppMessage(title,desc,link,imgUrl){    WeixinJSBridge.invoke('menuShareTimeline',{        title: "<?=$course['title']?>",        desc: "分享课程",        link: 'http://fineui.dye360.cn/Home/course/fx/<?=$id?>/<?=$_SESSION['app_home_session']['id']?>',        imgUrl:"<?=$course['article_image']?>" ,        success: function() {            alert("分享成功！")            // 用户确认分享后执行的回调函数        },        cancel: function() {            alert("取消分享！")            // 用户取消分享后执行的回调函数        }    });}function  getFxPrice() {    var url = "Home/myCourse/fxGetCoupon/<?=$id?>";    $.getJSON(url,function (data) {       alert(data.msg);    })}function WeiXinShareBtn(){    if (typeof WeixinJSBridge == "undefined") {        alert(" 请先通过微信搜索 wow36kr 添加36氪为好友，通过微信分享文章 :) ");    } else {        weixinSendAppMessage("33","22","http://fineui.dye360.cn/Home/course/fx/3");    }}</script><script type="text/javascript">    function reBuy(id){        var url = "Home/order/rebuy/"+id;        $.post(url,function (data) {           if(data.status){               alert("重新拼团成功");               window.location.reload();           }else{               alert(data.msg);           }        },"json")    }    jQuery(function(){        //jQuery('#qrcode').qrcode("Home/course/fx/<?//=$order['id']?>//");    });    function filterDeadline(time) {        //获取当前时间        var date = new Date();        var now = date.getTime();        //设置截止时间        var end = time;        //时间差        var leftTime = end-now;        //定义变量 d,h,m,s保存倒计时的时间        var d,h,m,s;        if (leftTime>=0) {            d = Math.floor(leftTime/1000/60/60/24);            h = Math.floor(leftTime/1000/60/60%24)+d*24;            m = Math.floor(leftTime/1000/60%60);            s = Math.floor(leftTime/1000%60);        }        function checkTime(time){            return time = time < 10 ? `0${time}` : time        }        return ` ${checkTime(h)}:${checkTime(m)}:${checkTime(s)}`    }    $('#ptTime').each(function () {        var ptTime = $(this).data('pttime');        var str = filterDeadline(ptTime*1000);        $(this).text(str);        setTime(this)    })    function setTime(obj){        setInterval(function () {            var ptTime = $(obj).data('pttime');            var str = filterDeadline(ptTime*1000);            $(obj).text(str);        }, 1000);    }</script></body></html>